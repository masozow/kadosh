{% extends 'kadoshapp/base.html' %}
{% load staticfiles %}
<!--se añadió la fila anterior-->
    {% block styles %}
      <link type="text/css" rel="stylesheet" href="{% static "css/formularios.css" %}"/>
    {% endblock %}

    {% block extra_scripts %}
    <script type="text/javascript">
    var selectDefault = $("#id_cliente_idcliente").html();

    $.extend($.expr[":"], {
      "starts-with": function(elem, i, data, set) {
        var text = $.trim($(elem).text()),
        term = data[3];
        // first index is 0
        return text.indexOf(term) === 0;
        },
      "ends-with": function(elem, i, data, set) {
        var text = $.trim($(elem).text()),
        term = data[3];
        // last index is last possible
        return text.lastIndexOf(term) === text.length - term.length;
        }
    });

        //Función que coloca el cursor en el textbox Nit del cliente, al momento de cargar la página
        $( document ).ready(function(){ //document indica toda la página, ready indica que ya se haya cargado el DOM
          $('input#id_nit_del_cliente').focus(); //se accede al input con el id que está después de #,
                                                 //.focus() indica que ahí se colocará el cursor
        });

        //Funcion para buscar el nit del cliente:
        $( 'input#id_nit_del_cliente' ).keyup(function(e){
          var nit = $('input#id_nit_del_cliente').val();
          if(e.keyCode=='8')
          {
            $("#id_cliente_idcliente").html(selectDefault);
          }
          if(nit==='')
          {
            //console.log("vacio:"+nit);
          }
          else {
            //console.log("nit:"+nit);
            $("#id_cliente_idcliente option:starts-with("+nit+")").attr('selected', true);
            /*
            var result=$("#id_cliente_idcliente option:starts-with("+nit+")");
            console.log(result.length);
            if(result.length==1){
              $("#id_cliente_idcliente").html(selectDefault);
            }
            */
            //var seleccionado=$("#id_cliente_idcliente option:selected").text();
          }
          //console.log("elemento:"+seleccionado);
        });

        //Función que controla el tabindex, para pasar de Nit del cliente a Código del producto
        $( 'input#id_nit_del_cliente' ).keydown(function(e){ //Keydown es para que al presionarse la tecla haga algo.
                                                            //El parámetro "e" captura la tecla del teclado
          var keyCode = e.keyCode || e.which; //se declara una variable que capturará cualquiera de esos dos valores
          if (e.keyCode==9||e.keyCode==13) { //keycode obtiene el valor ascii de la tecla presionada
            e.preventDefault(); //previene que se realice la acción por defecto que efectuaría el navegador con esa tecla
            var text=$("#id_cliente_idcliente option:selected").text().split(' ');
            var nit = $('input#id_nit_del_cliente').val();
            if(text[0]===nit)
            {
              $('input#id_codigo_producto').focus();
            }
            else {
              $('input#id_nit_del_cliente').val('');
              $('input#id_nit_del_cliente').focus();
              $("#id_cliente_idcliente").html(selectDefault);
              alert('El cliente no existe');
            }
          }
          //$('input#id_nit_del_cliente').focus();
        });
        //Función que realiza una acción al leer código de barras
        $( 'input#id_codigo_producto' ).keydown(function(e){
          var keyCode = e.keyCode || e.which; //la propiedad wich indica la tecla o el botón que se ha presionado específicamente
                                              //puede ser del teclado o del mouse, normaliza dos eventos: event.keyCode y event.charCode
          if(e.keyCode==13)
          {
            e.preventDefault();
            alert('Producto leído');
          }
        });
    </script>
    {% endblock %}

    {% block content %}

        <h5>Punto de Venta</h5>
        <form method="POST" class="post-form">
          {% csrf_token %}
            <p>
            <label>Cliente: </label>{{ form_cliente.nit_del_cliente}}{{form_Venta.cliente_idcliente}}
            <label for="id_codigo_producto">Código: </label>{{ form_Producto.codigo_producto }}
            <label>Cantidad: </label>{{form_DetalleVenta.cantidad_venta}}
            <label>Valor: </label>{{form_Precio.valor_precio}}
            <label for="check_mostrar">Mostrar caracteristicas del producto:</label> <input checked="checked" id="check_mostrar" name="mostrar_check" type="checkbox" /></p>
            <label for="check_promocion">Es promocion:</label> <input checked="false" id="check_promocion" name="promocion_check" type="checkbox" /></p>
            <label>Vendedor: </label>{{form_Producto.empleado_idempleado}}

            <div class="divider"></div>

            <p style="color: #80bfff;"><b>Características del producto</b></p>
            <p><label>Marca: </label>{{form_TipoProducto.marca_id_marca}}
            <label>Tipo: </label>{{form_estiloproducto.tipo_producto_idtipo_producto}}
            <label>Estilo: </label>{{form_Producto.estilo_idestilo}}
            <label for="id_talla_idtalla">Talla: </label>{{form_Producto.talla_idtalla}}
            <label>Color: </label>{{form_Producto.color_idcolor}}
            <label>Género: </label>{{form_Producto.genero_idgener}}
            <label>Combo: </label>{{form_Producto.combo_idcombo}}
            <label>Descripcion: </label>{{form_InventarioProducto.producto_codigo_producto}}
            </p>

            <div class="divider"></div>

            <p>
            <label>Al contado: </label>{{form_Venta.contado_venta}}
            </p>

            <div class="divider"></div>

            <p style="color: #80bfff;"><b>Promoción</b></p>
              <label>Nombre de la promocion: </label>{{form_cliente.nombre_delapromocion}}
              {{form_promocionhasproducto.promocion_idpromocion}}
            <p>

            </p>
            <div class="divider"></div>
            Aquí va la tabla
            <div class="divider"></div>
            <p>
              <label>Tipo de pago: </label>{{form_Venta.tipo_pago_idtipo_pago}}
              <button type="submit" class="save btn btn-default">Guardar</button>
              <button type="submit" class="save btn btn-default">Anular venta</button>
              <label>Código de autorización: </label>{{form_cliente.codigo_autorizacion}}
            </p>
            <div class="divider"></div>
            <div class="divider"></div>
        </form>
    {% endblock %}
